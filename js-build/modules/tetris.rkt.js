import * as $rjs_core from '../runtime/core.js';import * as M0 from "../links/racketscript-extras/racketscript/htdp/image.rkt.js";import * as M1 from "../runtime/kernel.rkt.js";import * as M2 from "../collects/racket/private/map.rkt.js";import * as M3 from "../collects/racket/private/list-predicates.rkt.js";import * as M4 from "../collects/racket/private/pre-base.rkt.js";import * as M5 from "../collects/racket/private/modbeg.rkt.js";import * as M6 from "../collects/racket/private/list.rkt.js";import * as M7 from "../collects/racket/list.rkt.js";import * as M8 from "../links/racketscript-extras/racketscript/htdp/universe.rkt.js";var let_result1 = M1.make_struct_type($rjs_core.PrimitiveSymbol.make("posn"),false,2,0,false,M1.rnull,M1.current_inspector(),false,$rjs_core.Pair.makeList(0,1),false,$rjs_core.PrimitiveSymbol.make("posn"));var struct_1 = let_result1.getAt(0);var make_2 = let_result1.getAt(1);var __p3 = let_result1.getAt(2);var __ref4 = let_result1.getAt(3);var __set_bang_5 = let_result1.getAt(4);var let_result2 = M1.values(struct_1,make_2,__p3,M1.make_struct_field_accessor(__ref4,0,$rjs_core.PrimitiveSymbol.make("x")),M1.make_struct_field_accessor(__ref4,1,$rjs_core.PrimitiveSymbol.make("y")));var struct_posn = let_result2.getAt(0);var posn1 = let_result2.getAt(1);var posn_p = let_result2.getAt(2);var posn_x = let_result2.getAt(3);var posn_y = let_result2.getAt(4);var let_result3 = M1.make_struct_type($rjs_core.PrimitiveSymbol.make("block"),false,3,0,false,M1.rnull,M1.current_inspector(),false,$rjs_core.Pair.makeList(0,1,2),false,$rjs_core.PrimitiveSymbol.make("block"));var struct_6 = let_result3.getAt(0);var make_7 = let_result3.getAt(1);var __p8 = let_result3.getAt(2);var __ref9 = let_result3.getAt(3);var __set_bang_10 = let_result3.getAt(4);var let_result4 = M1.values(struct_6,make_7,__p8,M1.make_struct_field_accessor(__ref9,0,$rjs_core.PrimitiveSymbol.make("x")),M1.make_struct_field_accessor(__ref9,1,$rjs_core.PrimitiveSymbol.make("y")),M1.make_struct_field_accessor(__ref9,2,$rjs_core.PrimitiveSymbol.make("color")));var struct_block = let_result4.getAt(0);var block2 = let_result4.getAt(1);var block_p = let_result4.getAt(2);var block_x = let_result4.getAt(3);var block_y = let_result4.getAt(4);var block_color = let_result4.getAt(5);var let_result5 = M1.make_struct_type($rjs_core.PrimitiveSymbol.make("tetra"),false,2,0,false,M1.rnull,M1.current_inspector(),false,$rjs_core.Pair.makeList(0,1),false,$rjs_core.PrimitiveSymbol.make("tetra"));var struct_11 = let_result5.getAt(0);var make_12 = let_result5.getAt(1);var __p13 = let_result5.getAt(2);var __ref14 = let_result5.getAt(3);var __set_bang_15 = let_result5.getAt(4);var let_result6 = M1.values(struct_11,make_12,__p13,M1.make_struct_field_accessor(__ref14,0,$rjs_core.PrimitiveSymbol.make("center")),M1.make_struct_field_accessor(__ref14,1,$rjs_core.PrimitiveSymbol.make("blocks")));var struct_tetra = let_result6.getAt(0);var tetra3 = let_result6.getAt(1);var tetra_p = let_result6.getAt(2);var tetra_center = let_result6.getAt(3);var tetra_blocks = let_result6.getAt(4);var let_result7 = M1.make_struct_type($rjs_core.PrimitiveSymbol.make("world"),false,2,0,false,M1.rnull,M1.current_inspector(),false,$rjs_core.Pair.makeList(0,1),false,$rjs_core.PrimitiveSymbol.make("world"));var struct_16 = let_result7.getAt(0);var make_17 = let_result7.getAt(1);var __p18 = let_result7.getAt(2);var __ref19 = let_result7.getAt(3);var __set_bang_20 = let_result7.getAt(4);var let_result8 = M1.values(struct_16,make_17,__p18,M1.make_struct_field_accessor(__ref19,0,$rjs_core.PrimitiveSymbol.make("tetra")),M1.make_struct_field_accessor(__ref19,1,$rjs_core.PrimitiveSymbol.make("blocks")));var struct_world = let_result8.getAt(0);var world4 = let_result8.getAt(1);var world_p = let_result8.getAt(2);var world_tetra = let_result8.getAt(3);var world_blocks = let_result8.getAt(4);var posn_eq__p = function(p121, p222) {if (M1.__eq_(posn_x(p121),posn_x(p222))!==false) {var if_res9 = M1.__eq_(posn_y(p121),posn_y(p222));} else {var if_res9 = false;}return if_res9;};var block_size = 20;var board_height = 20;var board_width = 10;var block_eq__p = function(b123, b224) {if (M1.__eq_(block_x(b123),block_x(b224))!==false) {var if_res10 = M1.__eq_(block_y(b123),block_y(b224));} else {var if_res10 = false;}return if_res10;};var block_move = function(dx25, dy26, b27) {return block2(dx25+block_x(b27),dy26+block_y(b27),block_color(b27));};var block_rotate_ccw = function(c28, b29) {return block2(posn_x(c28)+(posn_y(c28)-block_y(b29)),posn_y(c28)+(block_x(b29)-posn_x(c28)),block_color(b29));};var block_rotate_cw = function(c30, b31) {return block_rotate_ccw(c30,block_rotate_ccw(c30,block_rotate_ccw(c30,b31)));};var blocks_contains_p = function(bs32, b33) {return M2.ormap(function(c34) {return block_eq__p(b33,c34);},bs32);};var blocks_subset_p = function(bs135, bs236) {return M2.andmap(function(b37) {return blocks_contains_p(bs236,b37);},bs135);};var blocks_eq__p = function(bs138, bs239) {if (blocks_subset_p(bs138,bs239)!==false) {var if_res11 = blocks_subset_p(bs239,bs138);} else {var if_res11 = false;}return if_res11;};var blocks_intersect = function(bs140, bs241) {return M6.filter(function(b42) {return blocks_contains_p(bs241,b42);},bs140);};var blocks_count = function(bs43) {return M1.length(bs43);};var blocks_move = function(dx44, dy45, bs46) {return M2.map(function(b47) {return block_move(dx44,dy45,b47);},bs46);};var blocks_rotate_ccw = function(c48, bs49) {return M2.map(function(b50) {return block_rotate_ccw(c48,b50);},bs49);};var blocks_rotate_cw = function(c51, bs52) {return M2.map(function(b53) {return block_rotate_cw(c51,b53);},bs52);};var blocks_change_color = function(bs54, c55) {return M2.map(function(b56) {return block2(block_x(b56),block_y(b56),c55);},bs54);};var blocks_row = function(bs57, i58) {return M6.filter(function(b59) {return M1.__eq_(i58,block_y(b59));},bs57);};var full_row_p = function(bs60, i61) {return M1.__eq_(board_width,blocks_count(blocks_row(bs60,i61)));};var blocks_overflow_p = function(bs62) {return M2.ormap(function(b63) {return M1.__lt__eq_(block_y(b63),0);},bs62);};var blocks_union = function(bs164, bs265) {return M6.foldr(function(b66, bs67) {if (blocks_contains_p(bs67,b66)!==false) {var if_res12 = bs67;} else {var if_res12 = M1.cons(b66,bs67);}return if_res12;},bs265,bs164);};var blocks_max_y = function(bs68) {return M6.foldr(function(b69, n70) {return M1.max(block_y(b69),n70);},0,bs68);};var blocks_min_x = function(bs71) {return M6.foldr(function(b72, n73) {return M1.min(block_x(b72),n73);},board_width,bs71);};var blocks_max_x = function(bs74) {return M6.foldr(function(b75, n76) {return M1.max(block_x(b75),n76);},0,bs74);};var eliminate_full_rows = function(bs77) {return elim_row(bs77,board_height,0);};var elim_row = function(bs78, i79, offset80) {if (M1.__lt_(i79,0)!==false) {var if_res14 = M7.empty;} else {if (full_row_p(bs78,i79)!==false) {var if_res13 = elim_row(bs78,M1.sub1(i79),M1.add1(offset80));} else {var if_res13 = blocks_union(elim_row(bs78,M1.sub1(i79),offset80),blocks_move(0,offset80,blocks_row(bs78,i79)));}var if_res14 = if_res13;}return if_res14;};var tetra_move = function(dx81, dy82, t83) {return tetra3(posn1(dx81+posn_x(tetra_center(t83)),dy82+posn_y(tetra_center(t83))),blocks_move(dx81,dy82,tetra_blocks(t83)));};var tetra_rotate_ccw = function(t84) {return tetra3(tetra_center(t84),blocks_rotate_ccw(tetra_center(t84),tetra_blocks(t84)));};var tetra_rotate_cw = function(t85) {return tetra3(tetra_center(t85),blocks_rotate_cw(tetra_center(t85),tetra_blocks(t85)));};var tetra_overlaps_blocks_p = function(t86, bs87) {return M1.not(M3.empty_p(blocks_intersect(tetra_blocks(t86),bs87)));};var tetra_change_color = function(t88, c89) {return tetra3(tetra_center(t88),blocks_change_color(tetra_blocks(t88),c89));};var build_tetra_blocks = function(color90, xc91, yc92, x193, y194, x295, y296, x397, y398, x499, y4100) {return tetra_move(3,0,tetra3(posn1(xc91,yc92),M1.list(block2(x193,y194,color90),block2(x295,y296,color90),block2(x397,y398,color90),block2(x499,y4100,color90))));};var list_pick_random = function(ls101) {return M1.list_ref(ls101,M4.random(M1.length(ls101)));};var neg_1 = -1;var tetras = M1.list(build_tetra_blocks($rjs_core.UString.make("green"),1/2,-3/2,0,-1,0,-2,1,-1,1,-2),build_tetra_blocks($rjs_core.UString.make("blue"),1,-1,0,-1,1,-1,2,-1,3,-1),build_tetra_blocks($rjs_core.UString.make("purple"),1,-1,0,-1,1,-1,2,-1,2,-2),build_tetra_blocks($rjs_core.UString.make("cyan"),1,-1,0,-1,1,-1,2,-1,0,-2),build_tetra_blocks($rjs_core.UString.make("orange"),1,-1,0,-1,1,-1,2,-1,1,-2),build_tetra_blocks($rjs_core.UString.make("red"),1,-1,0,-1,1,-1,1,-2,2,-2),build_tetra_blocks($rjs_core.UString.make("pink"),1,-1,0,-2,1,-2,1,-1,2,-1));var touchdown = function(w102) {return world4(list_pick_random(tetras),eliminate_full_rows(blocks_union(tetra_blocks(world_tetra(w102)),world_blocks(w102))));};var world_jump_down = function(w103) {if (landed_p(w103)!==false) {var if_res15 = w103;} else {var if_res15 = world_jump_down(world4(tetra_move(0,1,world_tetra(w103)),world_blocks(w103)));}return if_res15;};var landed_on_blocks_p = function(w104) {return tetra_overlaps_blocks_p(tetra_move(0,1,world_tetra(w104)),world_blocks(w104));};var landed_on_floor_p = function(w105) {return M1.__eq_(blocks_max_y(tetra_blocks(world_tetra(w105))),M1.sub1(board_height));};var landed_p = function(w106) {var or_part107 = landed_on_blocks_p(w106);if (or_part107!==false) {var if_res16 = or_part107;} else {var if_res16 = landed_on_floor_p(w106);}return if_res16;};var next_world = function(w108) {if (landed_p(w108)!==false) {var if_res17 = touchdown(w108);} else {var if_res17 = world4(tetra_move(0,1,world_tetra(w108)),world_blocks(w108));}return if_res17;};var try_new_tetra = function(w109, new_tetra110) {var or_part111 = M1.__lt_(blocks_min_x(tetra_blocks(new_tetra110)),0);if (or_part111!==false) {var if_res19 = or_part111;} else {var or_part112 = M1.__gt__eq_(blocks_max_x(tetra_blocks(new_tetra110)),board_width);if (or_part112!==false) {var if_res18 = or_part112;} else {var if_res18 = tetra_overlaps_blocks_p(new_tetra110,world_blocks(w109));}var if_res19 = if_res18;}if (if_res19!==false) {var if_res20 = w109;} else {var if_res20 = world4(new_tetra110,world_blocks(w109));}return if_res20;};var world_move = function(dx113, dy114, w115) {return try_new_tetra(w115,tetra_move(dx113,dy114,world_tetra(w115)));};var world_rotate_ccw = function(w116) {return try_new_tetra(w116,tetra_rotate_ccw(world_tetra(w116)));};var world_rotate_cw = function(w117) {return try_new_tetra(w117,tetra_rotate_cw(world_tetra(w117)));};var ghost_blocks = function(w118) {return tetra_blocks(tetra_change_color(world_tetra(world_jump_down(w118)),$rjs_core.PrimitiveSymbol.make("gray")));};var world_key_move = function(w119, k120) {if (M1.equal_p(k120,$rjs_core.UString.make("left"))!==false) {var if_res25 = world_move(neg_1,0,w119);} else {if (M1.equal_p(k120,$rjs_core.UString.make("right"))!==false) {var if_res24 = world_move(1,0,w119);} else {if (M1.equal_p(k120,$rjs_core.UString.make("down"))!==false) {var if_res23 = world_jump_down(w119);} else {if (M1.equal_p(k120,$rjs_core.UString.make("a"))!==false) {var if_res22 = world_rotate_ccw(w119);} else {if (M1.equal_p(k120,$rjs_core.UString.make("s"))!==false) {var if_res21 = world_rotate_cw(w119);} else {var if_res21 = w119;}var if_res22 = if_res21;}var if_res23 = if_res22;}var if_res24 = if_res23;}var if_res25 = if_res24;}return if_res25;};var world__gt_image = function(w121) {return M0.frame(M0.place_image(blocks__gt_image(M1.append(tetra_blocks(world_tetra(w121)),M1.append(ghost_blocks(w121),world_blocks(w121)))),(board_width*block_size)/2,(board_height*block_size)/2,M0.empty_scene(board_width*block_size,board_height*block_size)));};var blocks__gt_image = function(bs122) {return M6.foldr(function(b123, img124) {if (M1.__lt__eq_(0,block_y(b123))!==false) {var if_res26 = place_block(b123,img124);} else {var if_res26 = img124;}return if_res26;},M0.empty_scene(M1.add1(board_width*block_size),M1.add1(board_height*block_size)),bs122);};var block__gt_image = function(b125) {return M0.overlay(M0.rectangle(M1.add1(block_size),M1.add1(block_size),$rjs_core.UString.make("solid"),block_color(b125)),M0.rectangle(M1.add1(block_size),M1.add1(block_size),$rjs_core.UString.make("outline"),$rjs_core.UString.make("black")));};var place_block = function(b126, scene127) {return M0.place_image(block__gt_image(b126),(block_x(b126)*block_size)+(block_size/2),(block_y(b126)*block_size)+(block_size/2),scene127);};var world0 = function() {return world4(list_pick_random(tetras),M7.empty);};M1.call_with_values(function() {return M8.big_bang(world0(),M8.on_tick(function(w128) {return next_world(w128);},0.1),M8.on_key(function(w129, ke130) {return world_key_move(w129,ke130);}),M8.to_draw(function(w131) {return world__gt_image(w131);}),M8.stop_when(function(w132) {return blocks_overflow_p(world_blocks(w132));}));},M5.__rjs_quoted__.print_values);var __rjs_quoted__ = {};__rjs_quoted__.block_p = block_p;__rjs_quoted__.struct_tetra = struct_tetra;__rjs_quoted__.tetra_blocks = tetra_blocks;__rjs_quoted__.world_tetra = world_tetra;__rjs_quoted__.posn_p = posn_p;__rjs_quoted__.tetra_p = tetra_p;__rjs_quoted__.struct_block = struct_block;__rjs_quoted__.block2 = block2;__rjs_quoted__.posn1 = posn1;__rjs_quoted__.tetra3 = tetra3;__rjs_quoted__.posn_y = posn_y;__rjs_quoted__.world_blocks = world_blocks;__rjs_quoted__.block_color = block_color;__rjs_quoted__.world4 = world4;__rjs_quoted__.world_p = world_p;__rjs_quoted__.block_y = block_y;__rjs_quoted__.tetra_center = tetra_center;__rjs_quoted__.struct_posn = struct_posn;__rjs_quoted__.block_x = block_x;__rjs_quoted__.struct_world = struct_world;__rjs_quoted__.posn_x = posn_x;export { __rjs_quoted__ };